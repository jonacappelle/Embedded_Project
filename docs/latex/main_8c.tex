\hypertarget{main_8c}{}\doxysection{Embedded\+\_\+1\+\_\+\+A\+M\+G8833\+\_\+\+Temp\+\_\+\+Sensor/src/main.c File Reference}
\label{main_8c}\index{Embedded\_1\_AMG8833\_Temp\_Sensor/src/main.c@{Embedded\_1\_AMG8833\_Temp\_Sensor/src/main.c}}


Code to read A\+M\+G8833.  


{\ttfamily \#include \char`\"{}em\+\_\+device.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}em\+\_\+chip.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}em\+\_\+cmu.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}em\+\_\+emu.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}em\+\_\+gpio.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}em\+\_\+rtc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}em\+\_\+core.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}A\+M\+G8833.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}I2\+C.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}em\+\_\+i2c.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}i2cspm.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug\+\_\+dbprint.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}em\+\_\+usart.\+h\char`\"{}}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{main_8c_ab5e09814056d617c521549e542639b7e}{Sys\+Tick\+\_\+\+Handler}} (void)
\begin{DoxyCompactList}\small\item\em Sys\+Tick\+\_\+\+Handler needed for timer functionality. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_af3c040fe31e69be32855715a75e0cda4}{delay\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Configure the Sys\+Tick to use cmu\+Clock\+\_\+\+C\+O\+RE for 1 ms interrupts. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_a87a8c0b4406c4c1dcd07a44faad32cc3}{delay}} (uint32\+\_\+t dly\+Ticks)
\begin{DoxyCompactList}\small\item\em Non-\/low-\/power delay, but non-\/blocking. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main}} (void)
\begin{DoxyCompactList}\small\item\em Main function. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
volatile uint32\+\_\+t \mbox{\hyperlink{main_8c_aa0136a2a587fb0a516dad92585b864d9}{ms\+Tick\+Count}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Code to read A\+M\+G8833. 

Project for Lab Embedded Systems 1 \begin{DoxyVersion}{Version}
1.\+0 
\end{DoxyVersion}
\begin{DoxyAuthor}{Author}
Jona Cappelle \& Thomas Feys
\end{DoxyAuthor}
\DoxyHorRuler


\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000001}{Todo}}]Future improvements\+:$\ast$$\ast$~\newline

\begin{DoxyItemize}
\item Implement state machine
\item Interrupt functionality
\item Make M\+CU low power by using E\+M2 R\+TC timers
\end{DoxyItemize}\end{DoxyRefDesc}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{main_8c_a87a8c0b4406c4c1dcd07a44faad32cc3}\label{main_8c_a87a8c0b4406c4c1dcd07a44faad32cc3}} 
\index{main.c@{main.c}!delay@{delay}}
\index{delay@{delay}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{delay()}{delay()}}
{\footnotesize\ttfamily void delay (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{dly\+Ticks }\end{DoxyParamCaption})}



Non-\/low-\/power delay, but non-\/blocking. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em dly\+Ticks} & How many milli seconds delay \\
\hline
\end{DoxyParams}


Definition at line 71 of file main.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{72 \{}
\DoxyCodeLine{73       uint32\_t curTicks;}
\DoxyCodeLine{74 }
\DoxyCodeLine{75       curTicks = msTicks;}
\DoxyCodeLine{76       \textcolor{keywordflow}{while} ((msTicks -\/ curTicks) < dlyTicks) ;}
\DoxyCodeLine{77 \}}

\end{DoxyCode}
\mbox{\Hypertarget{main_8c_af3c040fe31e69be32855715a75e0cda4}\label{main_8c_af3c040fe31e69be32855715a75e0cda4}} 
\index{main.c@{main.c}!delay\_init@{delay\_init}}
\index{delay\_init@{delay\_init}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{delay\_init()}{delay\_init()}}
{\footnotesize\ttfamily void delay\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Configure the Sys\+Tick to use cmu\+Clock\+\_\+\+C\+O\+RE for 1 ms interrupts. 



Definition at line 55 of file main.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{56 \{}
\DoxyCodeLine{57       \textcolor{comment}{/* Setup SysTick Timer for 1 msec interrupts  */}}
\DoxyCodeLine{58       \textcolor{keywordflow}{if} (SysTick\_Config(CMU\_ClockFreqGet(cmuClock\_CORE) / 1000)) \{}
\DoxyCodeLine{59         \textcolor{keywordflow}{while} (1) ;}
\DoxyCodeLine{60       \}}
\DoxyCodeLine{61 \}}

\end{DoxyCode}
\mbox{\Hypertarget{main_8c_a840291bc02cba5474a4cb46a9b9566fe}\label{main_8c_a840291bc02cba5474a4cb46a9b9566fe}} 
\index{main.c@{main.c}!main@{main}}
\index{main@{main}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Main function. 

We used a state machine to control the states where our microcontroller is in 

Definition at line 87 of file main.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{88 \{}
\DoxyCodeLine{89   \textcolor{comment}{/* Chip errata */}}
\DoxyCodeLine{90   CHIP\_Init();}
\DoxyCodeLine{91 }
\DoxyCodeLine{92   \textcolor{comment}{/* Enable GPIO clocks */}}
\DoxyCodeLine{93   CMU\_ClockEnable(cmuClock\_GPIO, \textcolor{keyword}{true});}
\DoxyCodeLine{94   CMU\_ClockEnable(cmuClock\_HFPER, \textcolor{keyword}{true}); \textcolor{comment}{// Needed to use GPIO}}
\DoxyCodeLine{95   CMU\_ClockEnable(cmuClock\_CORE, \textcolor{keyword}{true});}
\DoxyCodeLine{96 }
\DoxyCodeLine{97   \textcolor{comment}{/* Start I2C */}}
\DoxyCodeLine{98   \mbox{\hyperlink{_i2_c_8c_adc2aa003a8bc13c866e90661fa908189}{IIC\_Init}}();}
\DoxyCodeLine{99 }
\DoxyCodeLine{100   \textcolor{comment}{/* Start Delay */}}
\DoxyCodeLine{101   \mbox{\hyperlink{main_8c_af3c040fe31e69be32855715a75e0cda4}{delay\_init}}();}
\DoxyCodeLine{102 }
\DoxyCodeLine{103     \textcolor{comment}{/* Setup printing to virtual COM port */}}
\DoxyCodeLine{104 \textcolor{preprocessor}{\#if DEBUG\_DBPRINT == 1 }\textcolor{comment}{/* DEBUG\_DBPRINT */}\textcolor{preprocessor}{}}
\DoxyCodeLine{105     dbprint\_INIT(USART1, 4, \textcolor{keyword}{true}, \textcolor{keyword}{false});}
\DoxyCodeLine{106 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* DEBUG\_DBPRINT */}\textcolor{preprocessor}{}}
\DoxyCodeLine{107 }
\DoxyCodeLine{108   \textcolor{keywordtype}{float} rBuffer\_Thermistor[1];}
\DoxyCodeLine{109   \textcolor{keywordtype}{float} rBuffer\_Pixels[64];}
\DoxyCodeLine{110 }
\DoxyCodeLine{111 }
\DoxyCodeLine{112   \mbox{\hyperlink{_a_m_g8833_8c_a76e12be9b0c55532b6400f94a60ceadb}{AMG8833\_Thermistor\_Read}}(rBuffer\_Thermistor);}
\DoxyCodeLine{113 }
\DoxyCodeLine{114 }
\DoxyCodeLine{115 }
\DoxyCodeLine{116   \textcolor{comment}{/* Infinite loop */}}
\DoxyCodeLine{117   \textcolor{keywordflow}{while} (1) \{}
\DoxyCodeLine{118 }
\DoxyCodeLine{119       \textcolor{comment}{//AMG8833\_Pixels\_Read(rBuffer\_Pixels);}}
\DoxyCodeLine{120 }
\DoxyCodeLine{121       \textcolor{comment}{//AMG8833\_Pixel\_Print(rBuffer\_Pixels);}}
\DoxyCodeLine{122 }
\DoxyCodeLine{123       \mbox{\hyperlink{_a_m_g8833_8c_af57825d9792585be95870fde64d4c51c}{AMG8833\_Sleep}}(\textcolor{keyword}{false});}
\DoxyCodeLine{124       \mbox{\hyperlink{main_8c_a87a8c0b4406c4c1dcd07a44faad32cc3}{delay}}(500);}
\DoxyCodeLine{125 }
\DoxyCodeLine{126       \mbox{\hyperlink{_a_m_g8833_8c_ab4bcae84c5bbeed464be55a494aad6b4}{AMG8833\_StandBy}}(\mbox{\hyperlink{_a_m_g8833_8h_acc1094023bf211ea5d86b015f9b8146e}{STBY\_10}});}
\DoxyCodeLine{127       \mbox{\hyperlink{main_8c_a87a8c0b4406c4c1dcd07a44faad32cc3}{delay}}(500);}
\DoxyCodeLine{128 }
\DoxyCodeLine{129       \mbox{\hyperlink{_a_m_g8833_8c_ab4bcae84c5bbeed464be55a494aad6b4}{AMG8833\_StandBy}}(\mbox{\hyperlink{_a_m_g8833_8h_a5390b7679b27dfdedcf1ac5a88cc3593}{STBY\_60}});}
\DoxyCodeLine{130       \mbox{\hyperlink{main_8c_a87a8c0b4406c4c1dcd07a44faad32cc3}{delay}}(500);}
\DoxyCodeLine{131 }
\DoxyCodeLine{132       \mbox{\hyperlink{_a_m_g8833_8c_af57825d9792585be95870fde64d4c51c}{AMG8833\_Sleep}}(\textcolor{keyword}{true});}
\DoxyCodeLine{133       \mbox{\hyperlink{main_8c_a87a8c0b4406c4c1dcd07a44faad32cc3}{delay}}(500);}
\DoxyCodeLine{134 }
\DoxyCodeLine{135   \}}
\DoxyCodeLine{136 \}}

\end{DoxyCode}
\mbox{\Hypertarget{main_8c_ab5e09814056d617c521549e542639b7e}\label{main_8c_ab5e09814056d617c521549e542639b7e}} 
\index{main.c@{main.c}!SysTick\_Handler@{SysTick\_Handler}}
\index{SysTick\_Handler@{SysTick\_Handler}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{SysTick\_Handler()}{SysTick\_Handler()}}
{\footnotesize\ttfamily void Sys\+Tick\+\_\+\+Handler (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Sys\+Tick\+\_\+\+Handler needed for timer functionality. 



Definition at line 45 of file main.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{46 \{}
\DoxyCodeLine{47       msTicks++;       \textcolor{comment}{/* increment counter necessary in Delay()*/}}
\DoxyCodeLine{48 \}}

\end{DoxyCode}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{main_8c_aa0136a2a587fb0a516dad92585b864d9}\label{main_8c_aa0136a2a587fb0a516dad92585b864d9}} 
\index{main.c@{main.c}!msTickCount@{msTickCount}}
\index{msTickCount@{msTickCount}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{msTickCount}{msTickCount}}
{\footnotesize\ttfamily volatile uint32\+\_\+t ms\+Tick\+Count}



Definition at line 36 of file main.\+c.

